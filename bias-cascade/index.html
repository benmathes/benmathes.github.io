<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bias Cascade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Source Serif 4', serif; }
        .mono { font-family: 'Space Grotesk', sans-serif; }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            outline: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1f2937;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .funnel-stage {
            position: relative;
            transition: all 0.3s ease;
        }

        .funnel-bar {
            height: 40px;
            border-radius: 4px;
            transition: width 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
        }

        .group-a { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .group-b { background: linear-gradient(90deg, #f59e0b, #fbbf24); }

        .section-break {
            border: none;
            height: 2px;
            background: linear-gradient(to right, transparent, #d1d5db, transparent);
            margin: 2rem 0;
        }

        .bias-indicator {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">
    <div class="max-w-3xl mx-auto px-6 py-12">
        <header class="mb-8">
            <h1 class="mono text-3xl font-bold text-stone-900 mb-2">Bias Cascade</h1>
            <p class="text-stone-600 mono text-sm">How small biases at each stage compound into large disparities</p>
        </header>

        <article class="space-y-6">
            <p>
                A 5% bias doesn't sound like much. But when that 5% appears at <em>every stage</em> of a
                multi-stage process, the effects compound dramatically.
            </p>

            <p class="text-stone-600">
                Adjust the bias at each stage of this hiring funnel and watch how
                <span class="mono font-semibold text-blue-600">Group A</span> and
                <span class="mono font-semibold text-amber-600">Group B</span> diverge.
            </p>

            <hr class="section-break">

            <!-- Starting Population -->
            <div class="bg-white rounded-xl border border-stone-200 p-6 mb-6">
                <h2 class="mono text-lg font-semibold text-stone-900 mb-4">Starting Population</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="mono text-sm text-stone-600">Group A (Blue)</label>
                        <div class="flex items-center gap-3 mt-1">
                            <input type="range" id="groupA" class="slider flex-1" min="100" max="900" value="500" oninput="runSimulation()">
                            <span id="groupAValue" class="mono font-semibold w-16 text-right">500</span>
                        </div>
                    </div>
                    <div>
                        <label class="mono text-sm text-stone-600">Group B (Orange)</label>
                        <div class="flex items-center gap-3 mt-1">
                            <input type="range" id="groupB" class="slider flex-1" min="100" max="900" value="500" oninput="runSimulation()">
                            <span id="groupBValue" class="mono font-semibold w-16 text-right">500</span>
                        </div>
                    </div>
                </div>
                <p class="text-xs text-stone-400 mt-2">Both groups are equally qualified. Only the bias differs.</p>
            </div>

            <!-- Bias Controls -->
            <div class="bg-white rounded-xl border border-stone-200 p-6 space-y-5">
                <h2 class="mono text-lg font-semibold text-stone-900 mb-2">Bias at Each Stage</h2>
                <p class="text-sm text-stone-500 mb-4">Positive = favors Group A, Negative = favors Group B</p>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">üìÑ Resume Screen</label>
                        <span id="bias1Value" class="mono text-sm bias-indicator">+5%</span>
                    </div>
                    <input type="range" id="bias1" class="slider" min="-20" max="20" value="5" oninput="runSimulation()">
                </div>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">üìû Phone Screen</label>
                        <span id="bias2Value" class="mono text-sm bias-indicator">+5%</span>
                    </div>
                    <input type="range" id="bias2" class="slider" min="-20" max="20" value="5" oninput="runSimulation()">
                </div>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">üè¢ Onsite Interview</label>
                        <span id="bias3Value" class="mono text-sm bias-indicator">+5%</span>
                    </div>
                    <input type="range" id="bias3" class="slider" min="-20" max="20" value="5" oninput="runSimulation()">
                </div>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">‚úâÔ∏è Offer Decision</label>
                        <span id="bias4Value" class="mono text-sm bias-indicator">+5%</span>
                    </div>
                    <input type="range" id="bias4" class="slider" min="-20" max="20" value="5" oninput="runSimulation()">
                </div>

                <div class="pt-4 border-t border-stone-200">
                    <button onclick="setAllBias(0)" class="mono text-sm px-3 py-1 bg-stone-100 hover:bg-stone-200 rounded mr-2">Zero All</button>
                    <button onclick="setAllBias(5)" class="mono text-sm px-3 py-1 bg-stone-100 hover:bg-stone-200 rounded mr-2">+5% All</button>
                    <button onclick="setAllBias(10)" class="mono text-sm px-3 py-1 bg-stone-100 hover:bg-stone-200 rounded">+10% All</button>
                </div>
            </div>

            <hr class="section-break">

            <!-- The Funnel -->
            <div class="bg-white rounded-xl border border-stone-200 p-6">
                <h2 class="mono text-lg font-semibold text-stone-900 mb-6">The Funnel</h2>

                <div class="space-y-4" id="funnel">
                    <!-- Stages will be injected -->
                </div>

                <!-- Legend -->
                <div class="flex justify-center gap-8 mt-6 pt-4 border-t border-stone-100">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-gradient-to-r from-blue-500 to-blue-400"></div>
                        <span class="mono text-sm text-stone-600">Group A</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded bg-gradient-to-r from-amber-500 to-amber-400"></div>
                        <span class="mono text-sm text-stone-600">Group B</span>
                    </div>
                </div>
            </div>

            <!-- Results -->
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-stone-100 rounded-xl p-4 text-center">
                    <div class="mono text-xs text-stone-500 uppercase mb-1">Started Equal?</div>
                    <div id="startedEqual" class="mono text-lg font-bold text-stone-800">Yes</div>
                </div>
                <div class="bg-blue-50 rounded-xl p-4 text-center border border-blue-200">
                    <div class="mono text-xs text-blue-600 uppercase mb-1">Group A Hired</div>
                    <div id="hiredA" class="mono text-2xl font-bold text-blue-800">0</div>
                    <div id="hiredAPct" class="mono text-sm text-blue-600">0%</div>
                </div>
                <div class="bg-amber-50 rounded-xl p-4 text-center border border-amber-200">
                    <div class="mono text-xs text-amber-600 uppercase mb-1">Group B Hired</div>
                    <div id="hiredB" class="mono text-2xl font-bold text-amber-800">0</div>
                    <div id="hiredBPct" class="mono text-sm text-amber-600">0%</div>
                </div>
            </div>

            <!-- Compound Effect -->
            <div class="bg-rose-50 rounded-xl p-6 border border-rose-200">
                <h3 class="mono font-semibold text-rose-900 mb-2">Compound Effect</h3>
                <p class="text-rose-800">
                    Individual stage biases: <span id="individualBiases" class="mono font-semibold"></span>
                </p>
                <p class="text-rose-800 mt-2">
                    Combined effect: <span id="compoundEffect" class="mono font-bold text-xl"></span> disparity in outcomes
                </p>
            </div>

            <hr class="section-break">

            <!-- Insight -->
            <div id="insightBox" class="p-6 rounded-xl border-2 border-amber-200 bg-amber-50">
                <h3 class="mono font-semibold text-amber-900 mb-2">The math of compounding bias</h3>
                <p id="insightText" class="text-amber-800"></p>
            </div>

            <hr class="section-break">

            <!-- What this means -->
            <h2 class="mono text-lg font-semibold text-stone-900">Why this matters</h2>

            <div class="space-y-4">
                <p>
                    Each evaluator might genuinely believe they're being fair. A 5% bias is nearly
                    imperceptible at the individual level‚Äîit's the difference between a "maybe" becoming
                    a "yes" or a "no" in ambiguous cases.
                </p>
                <p>
                    But systems have many stages. And biases compound multiplicatively, not additively.
                    Four stages of 5% bias each don't create 20% disparity‚Äîthey create much more.
                </p>
                <p>
                    This is why looking at outcomes matters. If your final results show large disparities
                    despite equal starting populations, the bias is hiding somewhere in your process‚Äîeven
                    if no single stage looks problematic.
                </p>
            </div>
        </article>

        <footer class="mt-12 pt-8 border-t border-stone-200 text-center">
            <a href="/" class="mono text-sm text-stone-500 hover:text-stone-700">‚Üê Back to Projects</a>
            <p class="mt-4 text-xs text-stone-400">
                Explorable format inspired by <a href="https://worrydream.com/ExplorableExplanations/" class="underline hover:text-stone-600">Bret Victor</a>
            </p>
        </footer>
    </div>

    <script>
        const stages = [
            { name: 'Applicants', passRate: 1.0 },
            { name: 'Resume Screen', passRate: 0.3 },
            { name: 'Phone Screen', passRate: 0.5 },
            { name: 'Onsite', passRate: 0.4 },
            { name: 'Offers', passRate: 0.5 }
        ];

        function setAllBias(value) {
            document.getElementById('bias1').value = value;
            document.getElementById('bias2').value = value;
            document.getElementById('bias3').value = value;
            document.getElementById('bias4').value = value;
            runSimulation();
        }

        function runSimulation() {
            const startA = parseInt(document.getElementById('groupA').value);
            const startB = parseInt(document.getElementById('groupB').value);
            const biases = [
                0, // No bias at start
                parseInt(document.getElementById('bias1').value),
                parseInt(document.getElementById('bias2').value),
                parseInt(document.getElementById('bias3').value),
                parseInt(document.getElementById('bias4').value)
            ];

            // Update displayed values
            document.getElementById('groupAValue').textContent = startA;
            document.getElementById('groupBValue').textContent = startB;

            for (let i = 1; i <= 4; i++) {
                const val = biases[i];
                const el = document.getElementById('bias' + i + 'Value');
                el.textContent = (val >= 0 ? '+' : '') + val + '%';
                el.className = 'mono text-sm bias-indicator ' +
                    (val > 0 ? 'text-blue-600' : val < 0 ? 'text-amber-600' : 'text-stone-500');
            }

            // Calculate funnel
            let countA = startA;
            let countB = startB;
            const funnelData = [{ stage: 'Applicants', a: countA, b: countB }];

            for (let i = 1; i < stages.length; i++) {
                const baseRate = stages[i].passRate;
                const bias = biases[i] / 100;

                // Bias affects pass rates
                const rateA = Math.min(1, baseRate * (1 + bias));
                const rateB = Math.min(1, baseRate * (1 - bias));

                countA = Math.round(countA * rateA);
                countB = Math.round(countB * rateB);

                funnelData.push({ stage: stages[i].name, a: countA, b: countB });
            }

            // Render funnel
            renderFunnel(funnelData, startA, startB);

            // Update stats
            const finalA = funnelData[funnelData.length - 1].a;
            const finalB = funnelData[funnelData.length - 1].b;
            const total = finalA + finalB;

            document.getElementById('startedEqual').textContent = startA === startB ? 'Yes' : 'No';
            document.getElementById('hiredA').textContent = finalA;
            document.getElementById('hiredB').textContent = finalB;
            document.getElementById('hiredAPct').textContent = total > 0 ? Math.round(finalA / total * 100) + '%' : '0%';
            document.getElementById('hiredBPct').textContent = total > 0 ? Math.round(finalB / total * 100) + '%' : '0%';

            // Calculate compound effect
            const activeBiases = biases.slice(1).filter(b => b !== 0);
            document.getElementById('individualBiases').textContent =
                activeBiases.length > 0 ? activeBiases.map(b => (b >= 0 ? '+' : '') + b + '%').join(', ') : 'none';

            const disparity = total > 0 ? Math.abs((finalA / total) - 0.5) * 200 : 0;
            document.getElementById('compoundEffect').textContent = Math.round(disparity) + '%';

            // Update insight
            updateInsight(startA, startB, finalA, finalB, biases);
        }

        function renderFunnel(data, startA, startB) {
            const maxCount = Math.max(startA, startB);
            const funnel = document.getElementById('funnel');

            funnel.innerHTML = data.map((d, i) => {
                const widthA = (d.a / maxCount) * 100;
                const widthB = (d.b / maxCount) * 100;
                const total = d.a + d.b;
                const pctA = total > 0 ? Math.round(d.a / total * 100) : 50;

                return `
                    <div class="funnel-stage">
                        <div class="flex justify-between items-center mb-2">
                            <span class="mono text-sm font-semibold text-stone-700">${d.stage}</span>
                            <span class="mono text-xs text-stone-500">${d.a + d.b} total (${pctA}% A)</span>
                        </div>
                        <div class="flex gap-1">
                            <div class="funnel-bar group-a" style="width: ${widthA}%">
                                <span class="mono text-xs text-white font-semibold">${d.a}</span>
                            </div>
                            <div class="funnel-bar group-b" style="width: ${widthB}%">
                                <span class="mono text-xs text-white font-semibold">${d.b}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateInsight(startA, startB, finalA, finalB, biases) {
            const total = finalA + finalB;
            const startTotal = startA + startB;
            const startRatio = startA / startTotal;
            const endRatio = total > 0 ? finalA / total : 0.5;

            const avgBias = biases.slice(1).reduce((a, b) => a + b, 0) / 4;
            const stageCount = 4;

            let insight;

            if (Math.abs(avgBias) < 1) {
                insight = "With no bias, both groups progress through the funnel proportionally. The final ratio matches the starting ratio.";
            } else if (Math.abs(avgBias) < 6) {
                const shift = Math.abs(endRatio - startRatio) * 100;
                insight = `A small ${Math.abs(avgBias).toFixed(0)}% average bias across ${stageCount} stages shifted the final composition by ${shift.toFixed(0)} percentage points. That's the compound effect: (1.0${avgBias > 0 ? '+' : ''}${(avgBias/100).toFixed(2)})^${stageCount} ‚âà ${Math.pow(1 + avgBias/100, stageCount).toFixed(2)}x cumulative advantage.`;
            } else {
                const ratio = total > 0 ? Math.max(finalA, finalB) / Math.min(finalA, finalB) : 1;
                insight = `With ${Math.abs(avgBias).toFixed(0)}% average bias, the favored group ends up ${ratio.toFixed(1)}x more represented in final outcomes‚Äîdespite starting equal. This is why small biases create large disparities when processes have multiple gates.`;
            }

            document.getElementById('insightText').textContent = insight;
        }

        // Initialize
        runSimulation();
    </script>
</body>
</html>
