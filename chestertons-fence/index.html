<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chesterton's Fence | Explorable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Georgia', serif; }
        .fence-segment {
            transition: all 0.5s ease;
        }
        .fence-segment.removed {
            opacity: 0.2;
            transform: rotate(15deg) translateY(20px);
        }
        .consequence {
            transition: all 0.3s ease;
        }
        .consequence.revealed {
            opacity: 1;
            transform: translateY(0);
        }
        .consequence.hidden {
            opacity: 0;
            transform: translateY(10px);
        }
        .slider-container input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .timeline-dot {
            transition: all 0.3s ease;
        }
        .timeline-dot.active {
            transform: scale(1.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-bold text-amber-900 mb-2">Chesterton's Fence</h1>
        <p class="text-amber-700 mb-8 text-lg italic">"Don't remove a fence until you know why it was built."</p>

        <!-- Scenario Selector -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Choose a "Useless" Thing to Remove</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="selectScenario('meeting')" class="scenario-btn p-4 rounded-lg border-2 border-amber-200 hover:border-amber-500 transition-all" data-scenario="meeting">
                    <div class="text-2xl mb-1">üìÖ</div>
                    <div class="text-sm font-medium">Weekly Standup</div>
                </button>
                <button onclick="selectScenario('review')" class="scenario-btn p-4 rounded-lg border-2 border-amber-200 hover:border-amber-500 transition-all" data-scenario="review">
                    <div class="text-2xl mb-1">üëÄ</div>
                    <div class="text-sm font-medium">Code Review</div>
                </button>
                <button onclick="selectScenario('approval')" class="scenario-btn p-4 rounded-lg border-2 border-amber-200 hover:border-amber-500 transition-all" data-scenario="approval">
                    <div class="text-2xl mb-1">‚úÖ</div>
                    <div class="text-sm font-medium">Expense Approval</div>
                </button>
                <button onclick="selectScenario('docs')" class="scenario-btn p-4 rounded-lg border-2 border-amber-200 hover:border-amber-500 transition-all" data-scenario="docs">
                    <div class="text-2xl mb-1">üìù</div>
                    <div class="text-sm font-medium">Documentation</div>
                </button>
                <button onclick="selectScenario('testing')" class="scenario-btn p-4 rounded-lg border-2 border-amber-200 hover:border-amber-500 transition-all" data-scenario="testing">
                    <div class="text-2xl mb-1">üß™</div>
                    <div class="text-sm font-medium">QA Testing</div>
                </button>
                <button onclick="selectScenario('retro')" class="scenario-btn p-4 rounded-lg border-2 border-amber-200 hover:border-amber-500 transition-all" data-scenario="retro">
                    <div class="text-2xl mb-1">üîÑ</div>
                    <div class="text-sm font-medium">Retrospectives</div>
                </button>
                <button onclick="selectScenario('oncall')" class="scenario-btn p-4 rounded-lg border-2 border-amber-200 hover:border-amber-500 transition-all" data-scenario="oncall">
                    <div class="text-2xl mb-1">üìü</div>
                    <div class="text-sm font-medium">On-Call Rotation</div>
                </button>
                <button onclick="selectScenario('freeze')" class="scenario-btn p-4 rounded-lg border-2 border-amber-200 hover:border-amber-500 transition-all" data-scenario="freeze">
                    <div class="text-2xl mb-1">ü•∂</div>
                    <div class="text-sm font-medium">Deploy Freeze</div>
                </button>
            </div>
        </div>

        <!-- Main Simulation -->
        <div id="simulation" class="hidden">
            <!-- The Fence Visualization -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">The Fence: <span id="fence-name" class="text-amber-600"></span></h2>
                    <div class="text-sm text-gray-500">
                        Understanding: <span id="understanding-level" class="font-bold text-amber-600">0%</span>
                    </div>
                </div>

                <!-- Visual Fence -->
                <div class="relative h-32 bg-gradient-to-b from-green-100 to-green-200 rounded-lg mb-4 overflow-hidden">
                    <div class="absolute bottom-0 w-full flex justify-around items-end px-4">
                        <div id="fence-posts" class="flex justify-around w-full"></div>
                    </div>
                    <div id="creature" class="absolute text-4xl transition-all duration-500" style="bottom: 10px; left: -50px;">üê∫</div>
                </div>

                <!-- Complaint -->
                <div class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded mb-4">
                    <p class="text-amber-800 italic" id="complaint">"This fence is pointless! Nobody even knows why it's here."</p>
                </div>

                <!-- Investigation Progress -->
                <div class="mb-4">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>Investigation Progress</span>
                        <span id="investigation-percent">0%</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="investigation" min="0" max="100" value="0" class="w-full">
                    </div>
                </div>

                <!-- Discovery Timeline -->
                <div id="timeline" class="relative h-24 mt-8">
                    <div class="absolute top-1/2 left-0 right-0 h-1 bg-gray-200 rounded"></div>
                    <div id="timeline-progress" class="absolute top-1/2 left-0 h-1 bg-amber-500 rounded transition-all" style="width: 0%"></div>
                    <div id="timeline-dots" class="absolute top-1/2 left-0 right-0 flex justify-between transform -translate-y-1/2"></div>
                    <div id="discovery-text" class="absolute top-full left-0 right-0 text-center text-sm text-gray-600 mt-2"></div>
                </div>
            </div>

            <!-- Decision Panel -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Your Decision</h2>

                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <button onclick="removeFence()" id="remove-btn" class="p-4 rounded-lg border-2 border-red-300 hover:bg-red-50 transition-all text-left">
                        <div class="flex items-center gap-2 text-red-600 font-semibold mb-2">
                            <span>ü™ì</span> Remove the Fence
                        </div>
                        <p class="text-sm text-gray-600" id="remove-reasoning">It's slowing us down. Ship faster!</p>
                    </button>

                    <button onclick="keepFence()" id="keep-btn" class="p-4 rounded-lg border-2 border-green-300 hover:bg-green-50 transition-all text-left">
                        <div class="flex items-center gap-2 text-green-600 font-semibold mb-2">
                            <span>üõ°Ô∏è</span> Keep the Fence
                        </div>
                        <p class="text-sm text-gray-600" id="keep-reasoning">Investigate more first.</p>
                    </button>
                </div>

                <!-- Consequence Display -->
                <div id="consequence-panel" class="hidden">
                    <div id="consequence-content" class="p-4 rounded-lg"></div>
                </div>
            </div>

            <!-- Lessons Panel -->
            <div id="lessons-panel" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">What This Teaches Us</h2>
                <div id="lessons-content" class="space-y-3"></div>

                <div class="mt-6 p-4 bg-amber-50 rounded-lg">
                    <p class="text-amber-800 font-medium">Chesterton's Principle:</p>
                    <p class="text-amber-700 mt-2" id="principle-text"></p>
                </div>
            </div>
        </div>

        <!-- Stats Tracker -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-3">Your Track Record</h2>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                    <div class="text-2xl font-bold text-green-600" id="stat-wise">0</div>
                    <div class="text-sm text-gray-500">Wise Choices</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-red-600" id="stat-hasty">0</div>
                    <div class="text-sm text-gray-500">Hasty Removals</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-amber-600" id="stat-investigated">0</div>
                    <div class="text-sm text-gray-500">Investigated First</div>
                </div>
            </div>
        </div>

        <p class="text-center text-amber-600 mt-8 text-sm">
            Inspired by G.K. Chesterton's essay "The Thing" (1929)
        </p>
    </div>

    <script>
        const scenarios = {
            meeting: {
                name: "Weekly Standup Meeting",
                complaint: "These 15-minute meetings are a waste of time. Everyone just says 'I'm working on stuff.' We could use Slack instead!",
                creature: "üî•",
                creatureName: "Miscommunication",
                discoveries: [
                    { pct: 10, text: "Last year, two teams built the same feature independently", hidden: "wasted 3 months of work" },
                    { pct: 30, text: "A junior dev was stuck for 2 weeks before anyone noticed", hidden: "would have been caught day 1 in standup" },
                    { pct: 50, text: "The meeting was added after a production outage", hidden: "caused by teams not knowing each other's deploys" },
                    { pct: 70, text: "Remote workers report it's their only face time with the team", hidden: "isolation leads to turnover" },
                    { pct: 90, text: "The 'boring' format was intentional ‚Äî it's about surfacing blockers, not status", hidden: "async status exists in Jira already" }
                ],
                removeConsequence: {
                    immediate: "Velocity increases 3% in week one!",
                    week2: "Two people start working on the same bug unknowingly.",
                    month1: "New hire struggles silently for 3 weeks. Quits.",
                    month3: "Major integration breaks because teams didn't know about each other's changes.",
                    verdict: "The fence existed because coordination problems are invisible until they explode."
                },
                keepLesson: "The 15 minutes spent prevents 15 hours of rework. The meeting's value was never 'status' ‚Äî it was collision detection.",
                principle: "If you think a recurring meeting is useless, find out what happened the last time it was skipped. The story is usually enlightening."
            },
            review: {
                name: "Mandatory Code Review",
                complaint: "Code review slows us down! Senior devs should be trusted to ship directly. We're not Facebook in 2005.",
                creature: "üêõ",
                creatureName: "Silent Bugs",
                discoveries: [
                    { pct: 10, text: "A 'trusted' senior shipped a SQL injection last year", hidden: "everyone makes mistakes when tired" },
                    { pct: 30, text: "Reviews are how junior devs learn the codebase", hidden: "documentation alone doesn't transfer context" },
                    { pct: 50, text: "The policy was added after a $2M billing bug", hidden: "one character typo, caught in 10 minutes of review" },
                    { pct: 70, text: "Reviews catch 60% of bugs before QA", hidden: "QA is 10x more expensive to find bugs" },
                    { pct: 90, text: "Bus factor: reviews ensure at least 2 people know each piece of code", hidden: "what happens when people leave?" }
                ],
                removeConsequence: {
                    immediate: "Shipping speed doubles! Everyone's happy.",
                    week2: "A subtle bug ships that would have been caught in review.",
                    month1: "Senior dev goes on vacation. Nobody understands their code.",
                    month3: "Security audit finds 3 vulnerabilities that reviewers would have caught.",
                    verdict: "Code review wasn't about distrust ‚Äî it was about distributed knowledge and catching the errors everyone makes."
                },
                keepLesson: "The 30 minutes of review prevents 30 hours of debugging production. Plus, it's the best onboarding tool you have.",
                principle: "Processes that feel like bureaucracy often encode expensive lessons. The cost of the lesson is invisible; the cost of the process is visible."
            },
            approval: {
                name: "Expense Approval Workflow",
                complaint: "Why do I need approval for a $50 software license? Just trust employees! This is insulting.",
                creature: "üí∏",
                creatureName: "Hidden Costs",
                discoveries: [
                    { pct: 10, text: "Last year, 47 employees bought the same tool separately", hidden: "$50 √ó 47 = $2,350 for a $500 team license" },
                    { pct: 30, text: "Finance discovered 12 unused subscriptions running for months", hidden: "nobody noticed the auto-renewals" },
                    { pct: 50, text: "An employee bought a tool that didn't meet security requirements", hidden: "the approval process includes security review" },
                    { pct: 70, text: "The workflow was added after someone expensed a 'conference' that was a vacation", hidden: "trust was exploited once" },
                    { pct: 90, text: "Approval routing ensures the right budget gets charged", hidden: "otherwise everything hits one team's budget" }
                ],
                removeConsequence: {
                    immediate: "Everyone can finally get tools quickly!",
                    week2: "Duplicate purchases start accumulating.",
                    month1: "Shadow IT grows. Security has no visibility.",
                    month3: "Audit reveals $40K in redundant/unused subscriptions.",
                    verdict: "The approval wasn't about distrust ‚Äî it was about coordination, security review, and cost visibility."
                },
                keepLesson: "The friction serves multiple purposes: preventing duplicates, security vetting, and budget tracking. The question is whether to streamline it, not eliminate it.",
                principle: "When a process feels patronizing, ask what coordination problem it solves. Often it's not about trust ‚Äî it's about visibility across a large organization."
            },
            docs: {
                name: "Documentation Requirements",
                complaint: "Nobody reads docs anyway! Let the code be the documentation. Writing docs is where engineers go to waste time.",
                creature: "‚ùì",
                creatureName: "Lost Knowledge",
                discoveries: [
                    { pct: 10, text: "The original author of the payment system left 2 years ago", hidden: "nobody knows why certain edge cases are handled that way" },
                    { pct: 30, text: "New hires take 3 months to become productive", hidden: "there's no onboarding material" },
                    { pct: 50, text: "The same questions get asked in Slack every month", hidden: "tribal knowledge is being transmitted orally" },
                    { pct: 70, text: "A critical system was almost deleted because nobody knew what it did", hidden: "it processed $1M/day in reconciliation" },
                    { pct: 90, text: "The docs requirement came after a 2-week outage", hidden: "caused by a change to a system nobody understood" }
                ],
                removeConsequence: {
                    immediate: "Engineers ship 10% faster without doc overhead!",
                    week2: "No immediate problems visible.",
                    month1: "New hire keeps asking 'why does this work this way?'",
                    month3: "Key engineer leaves. Team realizes they can't maintain 3 critical systems.",
                    verdict: "Documentation wasn't for readers today ‚Äî it was insurance against knowledge loss tomorrow."
                },
                keepLesson: "Code tells you what. Only documentation tells you why. The investment pays off when the original author isn't available to explain.",
                principle: "If documentation seems useless, find out what happened the last time the expert left. The answer usually involves a lot of expensive archaeology."
            },
            testing: {
                name: "Manual QA Testing",
                complaint: "We have automated tests! Manual QA is slow and expensive. Developers should just write better tests.",
                creature: "üí•",
                creatureName: "Edge Cases",
                discoveries: [
                    { pct: 10, text: "Manual QA found 23 bugs last quarter that automated tests missed", hidden: "humans notice 'this feels wrong'" },
                    { pct: 30, text: "QA caught a UX issue: technically correct, but confusing", hidden: "automated tests can't measure confusion" },
                    { pct: 50, text: "The QA team was added after a compliance violation", hidden: "automated tests didn't check accessibility" },
                    { pct: 70, text: "QA serves as the 'first user' ‚Äî they find workflow problems", hidden: "devs test the happy path" },
                    { pct: 90, text: "QA maintains the test environment that everyone uses", hidden: "who will do this if QA is gone?" }
                ],
                removeConsequence: {
                    immediate: "Releases go out 2 days faster!",
                    week2: "A visual regression ships that automated tests didn't catch.",
                    month1: "Users report confusing workflows that 'technically work.'",
                    month3: "Accessibility lawsuit. Automated tests never checked screen readers.",
                    verdict: "Manual QA wasn't redundant ‚Äî they caught the category of bugs that can't be automated: 'does this make sense to a human?'"
                },
                keepLesson: "Automated tests verify the code works. Manual QA verifies the product works for humans. Different jobs.",
                principle: "When two things seem redundant, they usually test different failure modes. The question is which failure modes you can afford to miss."
            },
            retro: {
                name: "Sprint Retrospectives",
                complaint: "We never actually change anything from retros. It's just complaining for an hour. Let's ship instead.",
                creature: "üîÅ",
                creatureName: "Repeated Mistakes",
                discoveries: [
                    { pct: 10, text: "The team made the same deployment mistake 3 times this quarter", hidden: "each time people said 'we should fix this'" },
                    { pct: 30, text: "Retros identified the burnout risk before two people quit", hidden: "but no action was taken" },
                    { pct: 50, text: "The retro format was changed 6 months ago and participation dropped", hidden: "the old format actually produced actions" },
                    { pct: 70, text: "Retros are the only time ICs can raise systemic issues", hidden: "1:1s are about individual concerns" },
                    { pct: 90, text: "Other teams have retros that work ‚Äî the problem is execution, not the practice", hidden: "they assign owners and deadlines" }
                ],
                removeConsequence: {
                    immediate: "One more hour for 'real work!'",
                    week2: "Same problems keep happening. People grumble in Slack instead.",
                    month1: "Frustrations build with no outlet. Morale drops.",
                    month3: "Surprise resignation. 'I kept raising this issue but nothing changed.'",
                    verdict: "The retro wasn't the problem ‚Äî the lack of follow-through was. Removing the retro removed the last chance to surface issues."
                },
                keepLesson: "Retros that don't produce change are a symptom, not the disease. The fix is better follow-through, not elimination.",
                principle: "When a practice isn't working, distinguish between 'this practice is bad' and 'we're doing this practice badly.' They require opposite responses."
            },
            oncall: {
                name: "On-Call Rotation",
                complaint: "On-call is stressful and we rarely get paged. Just have the person who wrote the code fix it if it breaks.",
                creature: "‚è∞",
                creatureName: "3am Incidents",
                discoveries: [
                    { pct: 10, text: "The original author of the broken code was on vacation during the last outage", hidden: "systems break when their authors aren't available" },
                    { pct: 30, text: "On-call spreads knowledge ‚Äî everyone learns other people's systems", hidden: "reduces bus factor" },
                    { pct: 50, text: "The rotation was added after a 6-hour outage", hidden: "nobody knew who to call" },
                    { pct: 70, text: "On-call gives people ownership and skin in the game", hidden: "you build differently when you might get paged" },
                    { pct: 90, text: "'Rarely paged' means the system is healthy ‚Äî because of on-call culture", hidden: "people fix things before they page" }
                ],
                removeConsequence: {
                    immediate: "Engineers are happier without on-call stress!",
                    week2: "An alert fires. Nobody's sure who should respond.",
                    month1: "Outage at 3am. The code author is unreachable. 4-hour MTTR.",
                    month3: "Code quality declines. Nobody has skin in the game for reliability.",
                    verdict: "On-call wasn't just about incident response ‚Äî it was about creating ownership and forcing knowledge distribution."
                },
                keepLesson: "On-call is uncomfortable by design. That discomfort drives better monitoring, documentation, and code quality. Remove the discomfort, remove the incentive.",
                principle: "Some practices work precisely because they're unpleasant. The unpleasantness is the mechanism of action, not a side effect to eliminate."
            },
            freeze: {
                name: "Holiday Deploy Freeze",
                complaint: "Deploy freezes are paranoid! We have monitoring and rollback. Engineers should be trusted to make the call.",
                creature: "üéÑ",
                creatureName: "Holiday Disasters",
                discoveries: [
                    { pct: 10, text: "Last holiday, a 'small fix' caused a 4-hour outage", hidden: "on Christmas Day, with skeleton crew" },
                    { pct: 30, text: "Support volume triples during holidays", hidden: "worst time for an incident" },
                    { pct: 50, text: "Half the team is unreachable during the freeze period", hidden: "who would fix a bad deploy?" },
                    { pct: 70, text: "The freeze was added after a payment outage on Black Friday", hidden: "$2M in lost revenue" },
                    { pct: 90, text: "Freezes force teams to plan ahead and ship stable code before holidays", hidden: "the deadline creates discipline" }
                ],
                removeConsequence: {
                    immediate: "Engineers can ship that one last feature before break!",
                    week2: "A 'quick fix' goes out the day before Thanksgiving.",
                    month1: "Black Friday outage. Key responders are with family.",
                    month3: "Post-mortem reveals the deploy wasn't urgent ‚Äî it could have waited.",
                    verdict: "The freeze wasn't about distrust ‚Äî it was about aligning risk with available response capacity."
                },
                keepLesson: "Deploy freezes force a question: 'Is this change worth the risk when our ability to respond is impaired?' Usually, the answer is no.",
                principle: "Constraints that seem arbitrary often encode risk calculations. The calculation isn't 'can we do this?' but 'can we handle the worst case?'"
            }
        };

        let currentScenario = null;
        let investigationLevel = 0;
        let hasDecided = false;
        let stats = { wise: 0, hasty: 0, investigated: 0 };

        // Load stats from localStorage
        try {
            const saved = localStorage.getItem('chesterton-stats');
            if (saved) stats = JSON.parse(saved);
            updateStats();
        } catch (e) {}

        function selectScenario(id) {
            currentScenario = scenarios[id];
            hasDecided = false;
            investigationLevel = 0;

            // Update UI
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('bg-amber-100', 'border-amber-500');
            });
            document.querySelector(`[data-scenario="${id}"]`).classList.add('bg-amber-100', 'border-amber-500');

            document.getElementById('simulation').classList.remove('hidden');
            document.getElementById('fence-name').textContent = currentScenario.name;
            document.getElementById('complaint').textContent = currentScenario.complaint;

            // Reset investigation
            document.getElementById('investigation').value = 0;
            document.getElementById('investigation-percent').textContent = '0%';
            document.getElementById('understanding-level').textContent = '0%';
            document.getElementById('timeline-progress').style.width = '0%';

            // Build fence
            buildFence();

            // Build timeline
            buildTimeline();

            // Reset consequence panel
            document.getElementById('consequence-panel').classList.add('hidden');
            document.getElementById('lessons-panel').classList.add('hidden');

            // Reset creature
            const creature = document.getElementById('creature');
            creature.textContent = currentScenario.creature;
            creature.style.left = '-50px';
            creature.style.opacity = '0';

            // Update buttons
            document.getElementById('remove-btn').disabled = false;
            document.getElementById('keep-btn').disabled = false;
        }

        function buildFence() {
            const container = document.getElementById('fence-posts');
            container.innerHTML = '';
            for (let i = 0; i < 7; i++) {
                const post = document.createElement('div');
                post.className = 'fence-segment flex flex-col items-center';
                post.innerHTML = `
                    <div class="w-3 h-16 bg-amber-700 rounded-t"></div>
                    <div class="w-8 h-2 bg-amber-800 rounded"></div>
                `;
                container.appendChild(post);
            }
        }

        function buildTimeline() {
            const container = document.getElementById('timeline-dots');
            container.innerHTML = '';

            currentScenario.discoveries.forEach((d, i) => {
                const dot = document.createElement('div');
                dot.className = 'timeline-dot w-4 h-4 rounded-full bg-gray-300 cursor-pointer relative';
                dot.style.left = `${d.pct}%`;
                dot.style.transform = 'translateX(-50%)';
                dot.dataset.index = i;

                const tooltip = document.createElement('div');
                tooltip.className = 'absolute bottom-full mb-2 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs p-2 rounded whitespace-nowrap opacity-0 transition-opacity pointer-events-none';
                tooltip.textContent = d.text;
                dot.appendChild(tooltip);

                dot.addEventListener('mouseenter', () => {
                    if (investigationLevel >= d.pct) {
                        tooltip.classList.remove('opacity-0');
                    }
                });
                dot.addEventListener('mouseleave', () => {
                    tooltip.classList.add('opacity-0');
                });

                container.appendChild(dot);
            });
        }

        document.getElementById('investigation').addEventListener('input', function() {
            if (hasDecided) return;

            investigationLevel = parseInt(this.value);
            document.getElementById('investigation-percent').textContent = `${investigationLevel}%`;
            document.getElementById('understanding-level').textContent = `${investigationLevel}%`;
            document.getElementById('timeline-progress').style.width = `${investigationLevel}%`;

            // Update timeline dots
            const dots = document.querySelectorAll('.timeline-dot');
            dots.forEach((dot, i) => {
                const discovery = currentScenario.discoveries[i];
                if (investigationLevel >= discovery.pct) {
                    dot.classList.remove('bg-gray-300');
                    dot.classList.add('bg-amber-500', 'active');
                } else {
                    dot.classList.add('bg-gray-300');
                    dot.classList.remove('bg-amber-500', 'active');
                }
            });

            // Show current discovery
            const latestDiscovery = currentScenario.discoveries.filter(d => investigationLevel >= d.pct).pop();
            if (latestDiscovery) {
                document.getElementById('discovery-text').textContent = `üí° ${latestDiscovery.text}`;
            } else {
                document.getElementById('discovery-text').textContent = 'Drag to investigate why this fence exists...';
            }

            // Update reasoning text based on investigation level
            if (investigationLevel < 30) {
                document.getElementById('remove-reasoning').textContent = "It's slowing us down. Just remove it!";
                document.getElementById('keep-reasoning').textContent = "Maybe investigate a bit more first?";
            } else if (investigationLevel < 60) {
                document.getElementById('remove-reasoning').textContent = "Okay, there's some history, but we're different now.";
                document.getElementById('keep-reasoning').textContent = "There's more to discover here...";
            } else if (investigationLevel < 90) {
                document.getElementById('remove-reasoning').textContent = "I understand the history but still want to remove it.";
                document.getElementById('keep-reasoning').textContent = "I see why this exists now.";
            } else {
                document.getElementById('remove-reasoning').textContent = "I fully understand and consciously choose to remove it.";
                document.getElementById('keep-reasoning').textContent = "The fence earns its place. Keep it.";
            }
        });

        function removeFence() {
            if (hasDecided) return;
            hasDecided = true;

            // Animate fence removal
            document.querySelectorAll('.fence-segment').forEach((post, i) => {
                setTimeout(() => post.classList.add('removed'), i * 100);
            });

            // Animate creature entering
            const creature = document.getElementById('creature');
            creature.style.opacity = '1';
            setTimeout(() => {
                creature.style.left = '45%';
            }, 800);

            // Show consequences
            const c = currentScenario.removeConsequence;
            const panel = document.getElementById('consequence-panel');
            const content = document.getElementById('consequence-content');

            panel.classList.remove('hidden');
            content.className = 'p-4 rounded-lg bg-red-50 border-l-4 border-red-400';

            let html = `<h3 class="font-semibold text-red-800 mb-3">What Happens Next...</h3>`;

            const timeframes = [
                { label: 'Immediately', text: c.immediate, delay: 0 },
                { label: 'Week 2', text: c.week2, delay: 1000 },
                { label: 'Month 1', text: c.month1, delay: 2000 },
                { label: 'Month 3', text: c.month3, delay: 3000 },
                { label: 'Verdict', text: c.verdict, delay: 4000, isVerdict: true }
            ];

            content.innerHTML = html;

            timeframes.forEach(tf => {
                setTimeout(() => {
                    const div = document.createElement('div');
                    div.className = `consequence ${tf.isVerdict ? 'mt-4 pt-4 border-t border-red-200' : 'mb-2'} hidden`;
                    div.innerHTML = `
                        <span class="font-medium ${tf.isVerdict ? 'text-red-800' : 'text-red-700'}">${tf.label}:</span>
                        <span class="${tf.isVerdict ? 'text-red-800' : 'text-red-600'}">${tf.text}</span>
                    `;
                    content.appendChild(div);
                    setTimeout(() => {
                        div.classList.remove('hidden');
                        div.classList.add('revealed');
                    }, 50);
                }, tf.delay);
            });

            // Update stats
            if (investigationLevel < 50) {
                stats.hasty++;
            }
            saveStats();

            // Show lessons after consequences
            setTimeout(() => showLessons(false), 5500);

            document.getElementById('remove-btn').disabled = true;
            document.getElementById('keep-btn').disabled = true;
        }

        function keepFence() {
            if (hasDecided) return;
            hasDecided = true;

            const panel = document.getElementById('consequence-panel');
            const content = document.getElementById('consequence-content');

            panel.classList.remove('hidden');
            content.className = 'p-4 rounded-lg bg-green-50 border-l-4 border-green-400';

            if (investigationLevel >= 70) {
                content.innerHTML = `
                    <h3 class="font-semibold text-green-800 mb-2">Wise Choice</h3>
                    <p class="text-green-700">You investigated thoroughly before deciding. You now understand that: ${currentScenario.keepLesson}</p>
                `;
                stats.wise++;
                stats.investigated++;
            } else {
                content.innerHTML = `
                    <h3 class="font-semibold text-green-800 mb-2">Good Instinct, But...</h3>
                    <p class="text-green-700">You kept the fence, but you haven't fully understood why it exists. Keep investigating to learn the full story.</p>
                `;
            }

            saveStats();
            setTimeout(() => showLessons(true), 1500);

            document.getElementById('remove-btn').disabled = true;
            document.getElementById('keep-btn').disabled = true;
        }

        function showLessons(kept) {
            const panel = document.getElementById('lessons-panel');
            const content = document.getElementById('lessons-content');

            panel.classList.remove('hidden');

            let html = '';
            currentScenario.discoveries.forEach(d => {
                const discovered = investigationLevel >= d.pct;
                html += `
                    <div class="flex items-start gap-3 ${discovered ? '' : 'opacity-50'}">
                        <span class="${discovered ? 'text-amber-500' : 'text-gray-400'}">${discovered ? '‚úì' : '‚óã'}</span>
                        <div>
                            <p class="text-gray-700">${d.text}</p>
                            ${discovered ? `<p class="text-sm text-gray-500 mt-1">‚Ü≥ ${d.hidden}</p>` : ''}
                        </div>
                    </div>
                `;
            });

            content.innerHTML = html;
            document.getElementById('principle-text').textContent = currentScenario.principle;
        }

        function saveStats() {
            try {
                localStorage.setItem('chesterton-stats', JSON.stringify(stats));
            } catch (e) {}
            updateStats();
        }

        function updateStats() {
            document.getElementById('stat-wise').textContent = stats.wise;
            document.getElementById('stat-hasty').textContent = stats.hasty;
            document.getElementById('stat-investigated').textContent = stats.investigated;
        }

        // Initialize
        selectScenario('meeting');
    </script>
</body>
</html>
