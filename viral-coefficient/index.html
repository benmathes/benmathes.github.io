<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viral Coefficient Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Source Serif 4', serif; }
        .mono { font-family: 'Space Grotesk', sans-serif; }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            outline: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1f2937;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .section-break {
            border: none;
            height: 2px;
            background: linear-gradient(to right, transparent, #d1d5db, transparent);
            margin: 2rem 0;
        }

        .k-display {
            font-size: 4rem;
            line-height: 1;
            transition: color 0.3s ease;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">
    <div class="max-w-3xl mx-auto px-6 py-12">
        <header class="mb-8">
            <h1 class="mono text-3xl font-bold text-stone-900 mb-2">Viral Coefficient Calculator</h1>
            <p class="text-stone-600 mono text-sm">Why K=1.1 is completely different from K=0.9</p>
        </header>

        <article class="space-y-6">
            <p>
                The viral coefficient (K) is the average number of new users each existing user brings in.
                It seems like a small number, but there's a critical threshold at <span class="mono font-bold">K=1</span>
                where behavior changes dramatically.
            </p>

            <hr class="section-break">

            <!-- K Factor Display -->
            <div class="bg-white rounded-xl border border-stone-200 p-8 text-center">
                <div class="mono text-sm text-stone-500 uppercase mb-2">Your Viral Coefficient</div>
                <div id="kDisplay" class="k-display mono font-bold text-emerald-600">K = 1.00</div>
                <div id="kVerdict" class="mono text-lg text-stone-600 mt-2">At the tipping point</div>
            </div>

            <!-- Controls -->
            <div class="bg-white rounded-xl border border-stone-200 p-6 space-y-5">
                <h2 class="mono text-lg font-semibold text-stone-900 mb-4">K-Factor Components</h2>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">Invites Sent per User</label>
                        <span id="invitesValue" class="mono text-sm text-stone-500">3</span>
                    </div>
                    <input type="range" id="invites" class="slider" min="1" max="20" value="3" step="0.5" oninput="calculate()">
                    <p class="text-xs text-stone-400 mt-1">How many invites/shares each user sends on average</p>
                </div>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">Conversion Rate</label>
                        <span id="conversionValue" class="mono text-sm text-stone-500">33%</span>
                    </div>
                    <input type="range" id="conversion" class="slider" min="1" max="100" value="33" oninput="calculate()">
                    <p class="text-xs text-stone-400 mt-1">What % of invited people actually sign up</p>
                </div>

                <div class="pt-4 border-t border-stone-200">
                    <div class="mono text-sm text-stone-600">
                        K = <span id="invitesCalc" class="font-semibold">3</span> invites ×
                        <span id="conversionCalc" class="font-semibold">33%</span> conversion =
                        <span id="kCalc" class="font-bold text-lg">1.00</span>
                    </div>
                </div>
            </div>

            <!-- Growth Simulation Controls -->
            <div class="bg-white rounded-xl border border-stone-200 p-6 space-y-5">
                <h2 class="mono text-lg font-semibold text-stone-900 mb-4">Growth Simulation</h2>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">Initial Users (Seed)</label>
                        <span id="seedValue" class="mono text-sm text-stone-500">100</span>
                    </div>
                    <input type="range" id="seed" class="slider" min="10" max="1000" value="100" oninput="calculate()">
                </div>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">Cycle Time</label>
                        <span id="cycleValue" class="mono text-sm text-stone-500">7 days</span>
                    </div>
                    <input type="range" id="cycle" class="slider" min="1" max="30" value="7" oninput="calculate()">
                    <p class="text-xs text-stone-400 mt-1">How long each viral cycle takes</p>
                </div>

                <div>
                    <div class="flex justify-between mb-2">
                        <label class="mono text-sm font-semibold text-stone-700">Monthly Churn Rate</label>
                        <span id="churnValue" class="mono text-sm text-stone-500">5%</span>
                    </div>
                    <input type="range" id="churn" class="slider" min="0" max="30" value="5" oninput="calculate()">
                    <p class="text-xs text-stone-400 mt-1">What % of users leave each month</p>
                </div>
            </div>

            <hr class="section-break">

            <!-- Growth Chart -->
            <div class="bg-white rounded-xl border border-stone-200 p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="mono text-lg font-semibold text-stone-900">User Growth Over 6 Months</h2>
                </div>

                <svg id="chart" viewBox="0 0 600 300" class="w-full bg-stone-50 rounded-lg">
                    <!-- Grid -->
                    <g stroke="#e5e7eb" stroke-width="1">
                        <line x1="60" y1="260" x2="580" y2="260"></line>
                        <line x1="60" y1="200" x2="580" y2="200" stroke-dasharray="4,4"></line>
                        <line x1="60" y1="140" x2="580" y2="140" stroke-dasharray="4,4"></line>
                        <line x1="60" y1="80" x2="580" y2="80" stroke-dasharray="4,4"></line>
                        <line x1="60" y1="20" x2="580" y2="20" stroke-dasharray="4,4"></line>
                        <line x1="60" y1="20" x2="60" y2="260"></line>
                    </g>

                    <!-- Y axis labels -->
                    <text id="yMax" x="55" y="25" text-anchor="end" font-size="10" fill="#6b7280" class="mono">1M</text>
                    <text id="yMid" x="55" y="140" text-anchor="end" font-size="10" fill="#6b7280" class="mono">500K</text>
                    <text x="55" y="265" text-anchor="end" font-size="10" fill="#6b7280" class="mono">0</text>

                    <!-- X axis labels -->
                    <text x="60" y="280" font-size="10" fill="#6b7280" class="mono">0</text>
                    <text x="190" y="280" font-size="10" fill="#6b7280" class="mono">1mo</text>
                    <text x="320" y="280" font-size="10" fill="#6b7280" class="mono">3mo</text>
                    <text x="450" y="280" font-size="10" fill="#6b7280" class="mono">5mo</text>
                    <text x="575" y="280" font-size="10" fill="#6b7280" class="mono">6mo</text>

                    <!-- Growth line -->
                    <path id="growthLine" fill="none" stroke="#3b82f6" stroke-width="3"></path>

                    <!-- Fill area -->
                    <path id="growthArea" fill="rgba(59, 130, 246, 0.1)"></path>
                </svg>
            </div>

            <!-- Results -->
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-white rounded-xl p-4 border border-stone-200 text-center">
                    <div class="mono text-xs text-stone-500 uppercase mb-1">Month 1</div>
                    <div id="month1" class="mono text-xl font-bold text-stone-800">150</div>
                </div>
                <div class="bg-white rounded-xl p-4 border border-stone-200 text-center">
                    <div class="mono text-xs text-stone-500 uppercase mb-1">Month 3</div>
                    <div id="month3" class="mono text-xl font-bold text-stone-800">400</div>
                </div>
                <div id="month6Box" class="bg-emerald-50 rounded-xl p-4 border border-emerald-200 text-center">
                    <div class="mono text-xs text-emerald-600 uppercase mb-1">Month 6</div>
                    <div id="month6" class="mono text-xl font-bold text-emerald-800">1,200</div>
                </div>
            </div>

            <!-- Insight -->
            <div id="insightBox" class="p-6 rounded-xl border-2 border-amber-200 bg-amber-50">
                <h3 class="mono font-semibold text-amber-900 mb-2">The math</h3>
                <p id="insightText" class="text-amber-800"></p>
            </div>

            <hr class="section-break">

            <!-- K Value Comparison -->
            <h2 class="mono text-lg font-semibold text-stone-900">Why K=1 is the magic number</h2>

            <div class="grid grid-cols-3 gap-4 my-6">
                <div class="p-4 rounded-xl bg-red-50 border border-red-200 text-center">
                    <div class="mono text-2xl font-bold text-red-700">K &lt; 1</div>
                    <div class="mono text-sm text-red-600 mt-1">Fizzles</div>
                    <p class="text-xs text-red-500 mt-2">Each generation is smaller. Growth requires constant paid acquisition.</p>
                </div>
                <div class="p-4 rounded-xl bg-amber-50 border border-amber-200 text-center">
                    <div class="mono text-2xl font-bold text-amber-700">K = 1</div>
                    <div class="mono text-sm text-amber-600 mt-1">Linear</div>
                    <p class="text-xs text-amber-500 mt-2">Each user replaces themselves. Steady but not explosive growth.</p>
                </div>
                <div class="p-4 rounded-xl bg-emerald-50 border border-emerald-200 text-center">
                    <div class="mono text-2xl font-bold text-emerald-700">K &gt; 1</div>
                    <div class="mono text-sm text-emerald-600 mt-1">Exponential</div>
                    <p class="text-xs text-emerald-500 mt-2">Each generation is larger. True viral growth. Rare and powerful.</p>
                </div>
            </div>

            <p>
                The difference between K=0.9 and K=1.1 seems tiny—just 0.2. But over multiple cycles,
                it's the difference between your product dying and taking over the world.
            </p>
        </article>

        <footer class="mt-12 pt-8 border-t border-stone-200 text-center">
            <a href="/" class="mono text-sm text-stone-500 hover:text-stone-700">← Back to Projects</a>
            <p class="mt-4 text-xs text-stone-400">
                Explorable format inspired by <a href="https://worrydream.com/ExplorableExplanations/" class="underline hover:text-stone-600">Bret Victor</a>
            </p>
        </footer>
    </div>

    <script>
        function calculate() {
            const invites = parseFloat(document.getElementById('invites').value);
            const conversion = parseInt(document.getElementById('conversion').value);
            const seed = parseInt(document.getElementById('seed').value);
            const cycleDays = parseInt(document.getElementById('cycle').value);
            const monthlyChurn = parseInt(document.getElementById('churn').value);

            // Update displays
            document.getElementById('invitesValue').textContent = invites;
            document.getElementById('conversionValue').textContent = conversion + '%';
            document.getElementById('seedValue').textContent = seed;
            document.getElementById('cycleValue').textContent = cycleDays + ' days';
            document.getElementById('churnValue').textContent = monthlyChurn + '%';

            // Calculate K
            const k = invites * (conversion / 100);

            document.getElementById('invitesCalc').textContent = invites;
            document.getElementById('conversionCalc').textContent = conversion + '%';
            document.getElementById('kCalc').textContent = k.toFixed(2);

            // Update K display
            const kDisplay = document.getElementById('kDisplay');
            const kVerdict = document.getElementById('kVerdict');
            kDisplay.textContent = 'K = ' + k.toFixed(2);

            if (k < 0.8) {
                kDisplay.className = 'k-display mono font-bold text-red-600';
                kVerdict.textContent = 'Growth will fizzle quickly';
            } else if (k < 1) {
                kDisplay.className = 'k-display mono font-bold text-amber-600';
                kVerdict.textContent = 'Sub-viral: needs paid acquisition';
            } else if (k === 1) {
                kDisplay.className = 'k-display mono font-bold text-stone-600';
                kVerdict.textContent = 'At the tipping point';
            } else if (k < 1.5) {
                kDisplay.className = 'k-display mono font-bold text-emerald-600';
                kVerdict.textContent = 'Viral! Exponential growth';
            } else {
                kDisplay.className = 'k-display mono font-bold text-blue-600';
                kVerdict.textContent = 'Hyperviral! Explosive growth';
            }

            // Simulate growth
            const days = 180; // 6 months
            const cyclesPerDay = 1 / cycleDays;
            const dailyChurn = monthlyChurn / 100 / 30;

            let users = seed;
            const data = [users];

            for (let day = 1; day <= days; day++) {
                // Viral growth (fractional cycles per day)
                const newFromViral = users * (Math.pow(k, cyclesPerDay) - 1);

                // Churn
                const churned = users * dailyChurn;

                users = Math.max(0, users + newFromViral - churned);
                data.push(users);
            }

            // Draw chart
            drawChart(data);

            // Update stats
            document.getElementById('month1').textContent = formatNumber(data[30]);
            document.getElementById('month3').textContent = formatNumber(data[90]);
            document.getElementById('month6').textContent = formatNumber(data[180]);

            const month6Box = document.getElementById('month6Box');
            if (data[180] > seed * 10) {
                month6Box.className = 'bg-emerald-50 rounded-xl p-4 border border-emerald-200 text-center';
                document.getElementById('month6').className = 'mono text-xl font-bold text-emerald-800';
            } else if (data[180] > seed) {
                month6Box.className = 'bg-amber-50 rounded-xl p-4 border border-amber-200 text-center';
                document.getElementById('month6').className = 'mono text-xl font-bold text-amber-800';
            } else {
                month6Box.className = 'bg-red-50 rounded-xl p-4 border border-red-200 text-center';
                document.getElementById('month6').className = 'mono text-xl font-bold text-red-800';
            }

            // Update insight
            updateInsight(k, seed, data[180], monthlyChurn);
        }

        function formatNumber(n) {
            if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
            return Math.round(n).toString();
        }

        function drawChart(data) {
            const width = 600, height = 300;
            const padding = { left: 60, right: 20, top: 20, bottom: 40 };

            const maxVal = Math.max(...data, 100);

            // Update Y axis labels
            document.getElementById('yMax').textContent = formatNumber(maxVal);
            document.getElementById('yMid').textContent = formatNumber(maxVal / 2);

            const xScale = (i) => padding.left + (i / data.length) * (width - padding.left - padding.right);
            const yScale = (v) => height - padding.bottom - (v / maxVal) * (height - padding.top - padding.bottom);

            // Create line path
            const linePath = data.map((v, i) =>
                (i === 0 ? 'M' : 'L') + xScale(i) + ',' + yScale(v)
            ).join(' ');

            // Create area path
            const areaPath = linePath +
                ' L' + xScale(data.length - 1) + ',' + yScale(0) +
                ' L' + xScale(0) + ',' + yScale(0) + ' Z';

            document.getElementById('growthLine').setAttribute('d', linePath);
            document.getElementById('growthArea').setAttribute('d', areaPath);
        }

        function updateInsight(k, seed, final, churn) {
            let insight;

            if (k < 1) {
                const effectiveK = k - (churn / 100 / 4); // rough adjustment for churn
                insight = `With K=${k.toFixed(2)}, each viral cycle produces fewer users than the last. After accounting for ${churn}% monthly churn, you're losing users faster than gaining them. To sustain growth, you'd need to spend on acquisition to compensate for the K<1 deficit.`;
            } else if (k < 1.2) {
                insight = `K=${k.toFixed(2)} is just above viral threshold. Growth is real but slow—it takes many cycles to see significant numbers. The ${churn}% churn is a drag. Small improvements to K (better invites, higher conversion) would have outsized impact here.`;
            } else {
                const doublingCycles = Math.log(2) / Math.log(k);
                const doublingDays = doublingCycles * parseInt(document.getElementById('cycle').value);
                insight = `K=${k.toFixed(2)} means your user base roughly doubles every ${Math.round(doublingDays)} days. Starting from ${seed} users, you'd hit ${formatNumber(final)} in 6 months. At this rate, distribution is not your problem—retention and infrastructure are.`;
            }

            document.getElementById('insightText').textContent = insight;
        }

        // Initialize
        calculate();
    </script>
</body>
</html>
